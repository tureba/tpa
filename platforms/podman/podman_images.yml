---

# Â© Copyright EnterpriseDB UK Limited 2015-2021 - All rights reserved.

- name: Check if the required images exist already
  containers.podman.podman_image_info:
    name: "{{ podman_image_list }}"
  register: _available

- set_fact:
    _missing_images: "{{
      _missing_images|default([])|union([item])
    }}"
  with_items: "{{ podman_image_list }}"
  vars:
    _known_tags: >
      {{ query('flattened', _available.images|map(attribute='RepoTags')|list) }}
  when: >
    item not in _known_tags
    and item + ":latest" not in _known_tags

- include_tasks: podman_image.yml
  with_items: "{{ _missing_images|default([]) }}"
  loop_control:
    loop_var: image
